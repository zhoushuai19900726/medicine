<!DOCTYPE html>
<html lang="en" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" th:href="@{/layui2.0/lib/layui-v2.6.3/css/layui.css}" media="all">
    <link rel="stylesheet" th:href="@{/layui2.0/css/public.css}" media="all">
    <link rel="stylesheet" th:href="@{/layui2.0/lib/font-awesome-4.7.0/css/font-awesome.min.css}" media="all">
</head>
<body>
<div class="layuimini-container">
    <div class="layuimini-main" shiro:hasPermission="shopTransport:add">
        <form class="layui-form" action="" lay-filter="shopTransportForm" id="shopTransportForm" style="width: 100%;">
            <input name="id" hidden/>
            <div class="layui-form-item">
                <label class="layui-form-label required">经营店铺</label>
                <div class="layui-input-block">
                    <select name="sellerId" lay-filter="sellerId" lay-search lay-verify="required" th:with="sellerList=${@sellerService.list()}">
                        <option value="">请选择运营商家</option>
                        <option th:each="seller : ${sellerList}" th:text="${seller.sellerName}" th:value="${seller.id}"></option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label required">模板名称</label>
                <div class="layui-input-block">
                    <input type="text" name="name" lay-verify="required" placeholder="请输入名称" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label required">计价方式</label>
                <div class="layui-input-block">
                    <span th:with="dataResult=${@commonController.findAllPricingMethod()}">
                        <input type="radio" name="pricingMethod" th:each="map, mapStat : ${dataResult.getData()}" th:title="${map.get('name')}" th:checked="${mapStat.index == 0}"/>
                    </span>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label required">配送方式</label>
                <div class="layui-input-block">
                    <span th:with="dataResult=${@commonController.findAllShippingMethod()}">
                        <input type="checkbox" name="shippingMethod" th:each="map, mapStat : ${dataResult.getData()}" th:title="${map.get('name')}" th:checked="${mapStat.index == 0}"/>
                    </span>
                </div>
            </div>

            <input type="submit" lay-filter="submitBtnForAdd" id="submitBtnForAdd" lay-submit="" hidden/>
            <input type="submit" lay-filter="submitBtnForUpdate" id="submitBtnForUpdate" lay-submit="" hidden/>
        </form>


        <div class="layui-form-item">
            <label class="layui-form-label required">特殊地区不配送</label>
            <div class="layui-input-block">
                <div id="regionTest"></div>
            </div>
        </div>







    </div>
</div>
<script th:src="@{/js/core.util.js}" charset="utf-8"></script>
<script th:src="@{/layui2.0/lib/layui-v2.6.3/layui.js}" charset="utf-8"></script>
<script th:src="@{/layui2.0/js/lay-config.js(v=2.0.0)}" charset="utf-8"></script>
</body>
</html>
<script>
    //获取token
    var token = CoreUtil.getData("access_token");
    //地址栏转义token中的#号
    var tokenQuery = token.replace("#", "%23");
    var $ = jQuery = layui.jquery;
    layui.use(['form', 'layer', 'regionCheckBox'], function () {
        var form = layui.form;
        var layer = layui.layer;
        var regionCheckBox = layui.regionCheckBox;

        var regionList = {
            '中国': {
                '北京': [],
                '天津': [],
                '河北': ['石家庄', '唐山', '秦皇岛', '邯郸', '邢台', '保定', '张家界', '承德', '廊坊', '衡水', '沧州'],
                '山西': ['太原', '大同', '阳泉', '长治', '晋城', '朔州', '晋中', '运城', '忻州', '临汾', '吕梁'],
                '内蒙古': ['呼和浩特', '包头', '乌海', '赤峰', '通辽', '鄂尔多斯', '呼伦贝尔', '乌兰察布盟', '锡林郭勒盟', '巴彦淖尔盟', '阿拉善盟', '兴安盟'],
                '上海': [],
                '江苏': ['南京', '徐州', '连云港', '淮安', '宿迁', '盐城', '扬州', '泰州', '南通', '镇江', '常州', '无锡', '苏州'],
                '浙江': ['杭州', '宁波', '温州', '嘉兴', '湖州', '绍兴', '金华', '衢州', '舟山', '台州', '丽水'],
                '安徽': ['合肥', '芜湖', '蚌埠', '淮南', '马鞍山', '淮北', '铜陵', '安庆', '黄山', '滁州', '阜阳', '宿州', '六安', '亳州', '池州', '宣城'],
                '福建': ['福州', '厦门', '三明', '莆田', '泉州', '漳州', '南平', '龙岩', '宁德', '平潭'],
                '江西': ['南昌', '景德镇', '萍乡', '九江', '新余', '鹰潭', '赣州', '吉安', '宜春', '抚州', '上饶'],
                '山东': ['济南', '青岛', '淄博', '枣庄', '东营', '潍坊', '烟台', '威海', '济宁', '泰安', '日照', '莱芜', '临沂', '德州', '聊城', '滨州', '菏泽'],
                '河南': ['郑州', '开封', '洛阳', '平顶山', '焦作', '鹤壁', '新乡', '安阳', '濮阳', '许昌', '漯河', '三门峡', '南阳', '商丘', '信阳', '周口',
                    '驻马店', '济源'],
                '湖北': ['武汉', '黄石', '襄阳', '十堰', '荆州', '宜昌', '荆门', '鄂州', '孝感', '黄冈', '咸宁', '随州', '恩施土家族苗族自治州', '仙桃', '天门',
                    '潜江', '神农架林区'],
                '湖南': ['长沙', '株洲', '湘潭', '衡阳', '邵阳', '岳阳', '常德', '张家界', '益阳', '郴州', '永州', '怀化', '娄底', '湘西土家族苗族自治州'],
                '广东': ['广州', '深圳', '珠海', '汕头', '韶关', '河源', '梅州', '汕尾', '东莞', '中山', '江门', '佛山', '阳江', '湛江', '茂名', '肇庆', '清远',
                    '潮州', '揭阳', '云浮', '惠州'],
                '广西': ['南宁', '柳州', '桂林', '梧州', '北海', '防城港', '钦州', '贵港', '玉林', '百色', '贺州', '河池', '来宾', '崇左'],
                '海南': ['海口', '三亚', '文昌', '琼海', '万宁', '五指山', '东方', '儋州', '临高', '澄迈', '定安', '屯昌', '昌江黎族自治县', '白沙黎族自治县',
                    '琼中黎族苗族自治县', '陵水黎族自治县', '保亭黎族苗族自治县', '乐东黎族自治县', '三沙', '洋浦'],
                '重庆': [],
                '四川': ['成都', '自贡', '攀枝花', '泸州', '德阳', '绵阳', '广元', '遂宁', '内江', '乐山', '南充', '宜宾', '广安', '达州', '眉山', '雅安', '巴中',
                    '资阳', '阿坝藏族羌族自治州', '甘孜藏族自治州', '凉山彝族族自治州'],
                '贵州': ['贵阳', '六盘山', '遵义', '安顺', '铜仁', '毕节', '黔西南布依族苗族自治州', '黔东南苗族侗族自治州', '黔南布依族苗族自治州'],
                '云南': ['昆明', '曲靖', '玉溪', '宝山', '昭通', '普洱', '临沧', '丽江', '文山壮族苗族自治州', '红河哈尼族彝族自治州', '西双版纳傣族自治州',
                    '楚雄彝族自治州', '大理白族自治州', '德宏傣族景颇族自治州', '怒江傈傈族自治州', '迪庆藏族自治州'],
                '西藏': ['拉萨', '那曲', '昌都', '山南', '日喀则', '阿里', '林芝'],
                '陕西': ['西安', '铜川', '宝鸡', '咸阳', '渭南', '延安', '汉中', '榆林', '安康', '商洛'],
                '甘肃': ['兰州', '金昌', '白银', '天水', '嘉峪关', '武威', '张掖', '平凉', '酒泉', '庆阳', '定西', '陇南', '甘南藏族自治州', '临夏回族自治州'],
                '青海': ['西宁', '海东', '海北藏族自治州', '海南藏族自治州', '果洛藏族自治州', '玉树藏族自治州', '海西蒙古族藏族自治州', '黄南藏族自治州'],
                '宁夏': ['银川', '石嘴山', '吴忠', '固原', '中卫'],
                '新疆': ['乌鲁木齐', '克拉玛依', '石河子', '阿拉尔', '图木舒克', '五家渠', '吐鲁番', '哈密', '和田', '阿克苏', '喀什', '克孜勒苏柯尔克孜自治州',
                    '巴音郭楞蒙古自治州', '昌吉回族自治州', '博尔塔拉蒙古自治州', '伊犁哈萨克自治州', '塔城', '阿勒泰'],
                '辽宁': ['沈阳', '大连', '鞍山', '抚顺', '本溪', '丹东', '锦州', '葫芦岛', '营口', '盘锦', '阜新', '辽阳', '铁岭', '朝阳'],
                '吉林': ['长春', '吉林', '四平', '辽源', '通化', '白山', '延边朝鲜族自治州', '白城', '松原'],
                '黑龙江': ['哈尔滨', '齐齐哈尔', '鹤岗', '双鸭山', '鸡西', '大庆', '伊春', '牡丹江', '佳木斯', '七台河', '黑河', '绥化', '大兴安岭'],
                '香港': [],
                '澳门': [],
                '台湾': []
            },
        };


        //执行实例
        var regionTest = regionCheckBox.render({
            elem: '#regionTest',
            name: 'region', // 对应input name
            data: regionList,
            value: ['北京', '内蒙古', '江西-九江'], // 赋初始值，'北京,内蒙古,江西-九江'也可以
            width: '80%', // 默认550px
            border: true, // 默认true
            // 初始化完成时执行
            ready: function () {
                //  做些什么
                // form.render('checkbox');
            },
            // 点击复选框时执行
            change: function (result) {
                //  做些什么
                // form.render('checkbox');
                console.log(result)
            }
        });


        // 表单提交
        form.on('submit(submitBtnForAdd)', function (data) {
            // 当前容器的全部表单字段，名值对形式：{name: value}; 获取单个值data.field["title"]
            CoreUtil.sendPost("/shopTransport/add", data.field, function (res) {
                // 刷新父页面列表
                parent.layui.table.reload('showTable');
                // 提示
                layer.open({
                    content: '<i class="layui-icon layui-icon-face-smile" style="color: green;"></i> 保存成功'
                    , btn: ['继续添加', '返回列表']
                    , yes: function (index, layero) {
                        // 清空表单 （“brandForm”是表单的id）
                        $("#shopTransportForm")[0].reset();
                        form.render();
                        layer.close(index);
                    }, btn2: function (index, layero) {
                        //按钮【按钮二】的回调
                        var parentIndex = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(parentIndex);
                        //return false 开启该代码可禁止点击该按钮关闭
                    }, cancel: function () {
                        //右上角关闭回调
                        var parentIndex = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(parentIndex);
                        //return false 开启该代码可禁止点击该按钮关闭
                    }
                });
            });
            //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            return false;
        });
        form.on('submit(submitBtnForUpdate)', function (data) {
            // 当前容器的全部表单字段，名值对形式：{name: value}; 获取单个值data.field["title"]
            CoreUtil.sendPut("/shopTransport/update", data.field, function (res) {
                // 刷新父页面列表
                parent.layui.table.reload('showTable');
                parent.layer.msg("修改成功");
                var parentIndex = parent.layer.getFrameIndex(window.name);
                parent.layer.close(parentIndex);
            });
            //阻止表单跳转。如果需要表单跳转，去掉这段即可。
            return false;
        });
    });

    /**
     * 父级页面控制子页面提交表单
     */
    function saveShopTransport(submitBtn) {
        $("#" + submitBtn).click();
    }

    /**
     * 父级页面控制子页面填充
     */
    function assignment(data) {
        var form = layui.form,
            layarea = layui.layarea;
        // 表单赋值
        form.val("shopTransportForm", {
            "id": data.id
        });
    }

</script>
